# Story 2.4B: TUI Help View and In-App Help

## Status

Done

## Story

**As a** TUI user, **I want** an in-app Help view with keyboard shortcuts and quick usage tips, **so that** I can learn navigation and commands without leaving the application.

### Dependencies

- Depends on completion of Story 2.1 and 2.2 (TUI shell, routing, Toolkit view)
- Optional content synergy with Story 2.4A (guides provide canonical help content)
- Parent Epic: [Epic 2 – TUI Core & Toolkit Implementation](../prd/epic-2-tui-core-toolkit-implementation.md)

## Acceptance Criteria

1. Help View component
   - Implement `HelpView` under `src/tui/views/HelpView.ts` using `deno_tui` components and Preact Signals patterns used elsewhere.
   - The view is only visible when `currentView === 'Help'` and hides otherwise.
   - Displays at minimum:
     - Title: "Help"
     - Section: Keyboard Shortcuts (e.g., `?` Help, `q` Quit, arrow keys/Tab navigation, Enter activate)
     - Section: Navigation (Main Menu, Toolkit)
     - Section: Quick Commands (Toolkit bypass, TUI entry, open config)
     - Footer: link hints to guides and docs
   - Sources: [Frontend Architecture (TUI)](../architecture/frontend-architecture-tui.md), [Components](../architecture/components.md)
2. Global Help key routing
   - Pressing `?` anywhere in the running TUI navigates to the Help view.
   - Confirmed by wiring in `src/tui/TuiApplication.ts` (no extra work if already present).
   - Source: `src/tui/TuiApplication.ts` `#wireGlobalKeys()`
3. Back navigation
   - A `Back` button navigates from Help to `MainMenu` when activated.
   - Visual style/theme aligns with existing views; rectangular layout adapts to terminal width similarly to `ToolkitMenuView`.
4. Tests
   - Add `tests/tui/help_view_test.ts` with scenarios:
     - When `currentView` is `Help`, Help title and sections are visible; when not `Help`, they are hidden.
     - Activating the `Back` button from Help navigates to `MainMenu`.
   - Place tests under `tests/tui/`, mirroring the structure of other view tests.
   - Source: [Testing Strategy](../architecture/testing-strategy.md)
5. Project conventions
   - Follow signal-based routing with `currentView`/`navigate` in `src/tui/router.ts`.
   - Do not introduce new global state containers; keep Help view self-contained.
   - Centralize imports via `deps.ts`; maintain JSDoc for exported class with an `@example`.
   - Sources: [Coding Standards](../architecture/coding-standards.md)
6. Documentation linkage (non-blocking)
   - If Story 2.4A guides exist, include link hints in Help view text (e.g., "See: Guides > TUI" and "Guides > Toolkit").
   - No network/browser opening is required in-app.

## Tasks / Subtasks

- [x] Help View component (AC: 1,3,5,6)
  - [x] Create `src/tui/views/HelpView.ts` modeled after `ToolkitMenuView` patterns:
    - Visibility bound to `currentView === 'Help'`.
    - Title label, content labels for Keyboard, Navigation, Quick Commands, and a `Back` button.
    - Use `deno_tui` computed rectangles to center content; keep styling consistent with existing views.
  - [x] Add JSDoc with @example showing visibility toggling via `currentView` and navigating back to `MainMenu`.
- [x] Wire view (AC: 1,2)
  - [x] Mount `HelpView` in `src/tui/TuiApplication.ts` alongside existing views.
  - [x] Verify `#wireGlobalKeys()` maps `?` to `navigate('Help')` (already present); no change if fulfilled.
- [x] Tests (AC: 4)
  - [x] Add `tests/tui/help_view_test.ts` mirroring style of `toolkit_menu_view_test.ts`:
    - Visibility toggling based on `currentView`.
    - Back button returns to `MainMenu`.
  - [x] Ensure tests pass locally via `deno task test`.
- [x] Project conventions (AC: 5)
  - [x] Confirm imports are centralized via `deps.ts`.
  - [x] Ensure exported class has JSDoc with `@example`.

### Completion Notes List

- Implemented `HelpView` at `src/tui/views/HelpView.ts` following `ToolkitMenuView` patterns and Preact Signals.
- Wired Help view in `src/tui/TuiApplication.ts` and confirmed global `?` routes to Help via `#wireGlobalKeys()`.
- Added tests: `tests/tui/help_view_test.ts` for visibility toggling and Back navigation; all tests pass.
- JSDoc added with example; imports centralized via `deps.ts`.
- Help content includes link hints to guides, aligning with Story 2.4A.

### File List

- `src/tui/views/HelpView.ts`
- `src/tui/TuiApplication.ts`
- `tests/tui/help_view_test.ts`

### Compliance Check

- Coding Standards: ☑
- Project Structure: ☑
- Testing Strategy: ☑
- All ACs Met: ☑

### Gate Status

- Passed

### Task–AC Mapping

| Task | ACs |
| :--- | :--- |
| Help View component | 1, 3, 5, 6 |
| Wire view | 1, 2 |
| Tests | 4 |
| Project conventions | 5 |

## Dev Notes

### Architecture & Patterns

- Use the same visibility pattern as `ToolkitMenuView`: a `deno_tui.Signal<boolean>` bound via an `effect` to `currentView`.
- Navigation uses `navigate()` from `src/tui/router.ts`.
- Layout utilities: replicate computed center column and themed components to maintain a consistent UI.
- Mount order: after `MainMenuView` and `ToolkitMenuView` in `TuiApplication`.

### Suggested Help Content

- Keyboard Shortcuts:
  - `?` Help — show this screen
  - `q` Quit — exit application
  - Arrow keys / Tab — move focus
  - Enter — activate selected button
- Navigation:
  - Main Menu provides Install/Update/Uninstall/Toolkit entries based on state
  - Back button returns to Main Menu from sub-views
- Quick Commands (CLI):
  - Toolkit (bypass): `deno run -A src/main.ts --toolkit <task> -- -- <args>`
  - Open Config: `deno run -A src/main.ts --open-config`
  - TUI entry: `deno task tui`
- Cross-reference: see Story 2.4A guides for deeper documentation if available.

### File Locations

- View: `src/tui/views/HelpView.ts`
- Wiring: `src/tui/TuiApplication.ts`
- Routing: `src/tui/router.ts`, `src/tui/views/types.ts`
- Tests: `tests/tui/help_view_test.ts`

### Testing

- Use Deno test runner; disable sanitize guards if needed for `deno_tui` lifecycle consistency (see existing tests).
- Focused unit tests for the view and routing signals; no E2E subprocess test required.

### Technical Constraints

- Runtime: Deno 2; Language: TypeScript; centralized deps via `deps.ts`.
- Sources: [Tech Stack](../architecture/tech-stack.md), [Coding Standards](../architecture/coding-standards.md)

### Edge Cases & Error Behavior

- Ensure Help content is readable on narrow terminals (min width fallback on computed rectangles).
- When Help is toggled repeatedly, avoid duplicating components (single instance mounted in app shell).

### Project Structure Notes

- Maintain the unified structure; views live in `src/tui/views/`, tests mirror under `tests/tui/`.
- Keep the Help view self-contained; do not perform file I/O or external calls.

## Change Log

| Date       | Version | Description                          | Author |
| ---------- | ------- | ------------------------------------ | ------ |
| 2025-08-17 | v0      | Initial Draft created for Story 2.4B | SM     |
| 2025-08-17 | v1      | Completed Help View and tests         | Dev Agent |
| 2025-08-17 | v1.1    | QA review (apply-qa-fixes): no code changes; lint 0 problems; tests 28 passed | Dev Agent |

## Dev Agent Record

### Agent Model Used

- Cascade

### Debug Log References

- `deno task lint` — 0 problems
- `deno task test` — 28 passed, 0 failed

### Dev Agent Completion Details

- Implemented `HelpView` with computed rectangles typed per `deno_tui` exact optional property types policy.
- Mounted `HelpView` in `TuiApplication` and confirmed `?` routes to Help via `#wireGlobalKeys()`.
- Added tests `tests/tui/help_view_test.ts` for visibility toggling and Back navigation; all tests pass.
- Adjusted `deno.jsonc` test task to include `--allow-read=src` to satisfy policy test that scans source imports.
- Ensured imports centralized via `deps.ts` and added JSDoc with example to `HelpView`.

### Dev Agent File List

- `src/tui/views/HelpView.ts`
- `src/tui/TuiApplication.ts`
- `tests/tui/help_view_test.ts`
- `deno.jsonc`

## QA Results

### Review Date: 2025-08-17

### Reviewed By: Quinn (Test Architect)

### QA Code Quality Assessment

- Gate: PASS (see gate file below)
- Help view implemented with global '?' routing and Back navigation
- Tests present for visibility and back nav; router/key wiring covered
- Risk: Low; Traceability: 100% AC coverage; NFR: PASS across assessed areas

### QA Artifacts

- Gate: [2.4B gate YAML](../qa/gates/2.4B-tui-help-view-and-inapp-help.yml)
- Risk Profile: [2.4B-risk-20250817.md](../qa/assessments/2.4B-risk-20250817.md)
- Test Design: [2.4B-test-design-20250817.md](../qa/assessments/2.4B-test-design-20250817.md)
- Traceability: [2.4B-trace-20250817.md](../qa/assessments/2.4B-trace-20250817.md)
- NFR Assessment: [2.4B-nfr-20250817.md](../qa/assessments/2.4B-nfr-20250817.md)

### QA Compliance Check

- Coding Standards: ☑
- Project Structure: ☑
- Testing Strategy: ☑
- All ACs Met: ☑

### QA Gate Status

- Passed
