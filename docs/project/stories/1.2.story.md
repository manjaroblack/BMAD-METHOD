# Story 1.2: Project structure and CLI bootstrap

## Status

Done

## Story

**As a** Developer,
**I want** the unified project structure scaffolded and a minimal CLI entry point implemented,
**so that** we can build features in a consistent layout and run the application via a simple command.
Scope: Assumes Story 1.1 completed configuration; this story focuses on structure scaffolding and minimal CLI bootstrap, with configuration changes limited to alignment.

## Acceptance Criteria

1. Unified project structure scaffolded: create `src/` with `assets/`, `modules/`, `agents/`, `services/`, `tui/`, `core/` per architecture guide.
2. Minimal CLI entry exists at `src/main.ts` supporting `--help` and `--version`, printing a usage banner.
3. Centralized imports used: CLI imports std utilities via `deps` alias; `deps.ts` re-exports required std utilities/types.
4. Lint/format include/exclude patterns align with structure (include `src/`, `tests/`; exclude `dist/`, `coverage/`, `vendor/`, `node_modules/`, `.git/`).
5. deno tasks validate locally at minimum: `fmt:check`, `lint`, `test`; coverage produces `coverage.lcov`.
6. Tests discover via globs and a CLI smoke test asserts `--help` prints usage and exits with code 0.
7. CI remains valid for the structure (no changes needed) or a follow-up note is documented if changes are required.

## Tasks / Subtasks

- [x] Scaffold unified project structure (AC: 1,4)
  - [x] Create `src/` with initial folders from the structure: `assets/`, `modules/`, `agents/`, `services/`, `tui/`, `core/` (AC: 1)  
    [Source](../architecture/unified-project-structure.md#tui-application-structure)
  - [x] Ensure `.github/workflows/` location aligns with structure and existing CI file (AC: 7)  
    [Source](../architecture/unified-project-structure.md#tui-application-structure)
- [x] Implement minimal CLI entry `src/main.ts` (AC: 2)
  - [x] Add a basic program that supports `--help` and `--version` and prints a friendly usage string (AC: 2)  
    [Source](../architecture/tech-stack.md#tech-stack)
  - [x] Use centralized imports via `deps` alias for any std utilities (e.g., flags/log) (AC: 3)  
    [Source](../typescript-rules.md#dependency--import-strategy-jsr-first-depsts-pinning)
- [x] Update `deps.ts` to re-export required std utilities/types for CLI (AC: 3)
  - [x] Re-export `parse` from `@std/flags` as `parseFlags` and std `log` utilities, pinned to versions as needed (AC: 3)  
    [Source](../typescript-rules.md#dependency--import-strategy-jsr-first-depsts-pinning)
- [x] Add smoke test for CLI (AC: 6)
  - [x] `tests/cli_main_test.ts`: spawn the program (or call `main`) to assert that `--help` prints usage and exits 0 (AC: 6)  
    [Source](../architecture/testing-strategy.md)
- [x] Align config and tasks with new structure (AC: 4,5,7)
  - [x] Ensure `fmt`/`lint` include `src/` and `tests/` and exclude `dist/`, `coverage/`, `vendor/`, `node_modules/`, `.git/` (AC: 4)  
    [Source](../typescript-rules.md#project-configuration--ci)
  - [x] Verify deno tasks run locally: `fmt`, `fmt:check`, `lint`, `lint:fix`, `test`, `bench`, `coverage`, `cache`, `upgrade`, `lock:freeze` (AC: 5,7)  
    [Source](../architecture/tech-stack.md#tech-stack)

## Dev Notes

### Previous Story Insights

- Configuration is validated and CI-ready; strict TS enabled and `nodeModulesDir` is `none`.  
  [Source](1.1.story.md#completion-notes-list)
- `deps.ts` exists; imports map `deps` is configured for centralized imports.  
  [Source](1.1.story.md#completion-notes-list)
- Tests directory `tests/` exists and `deno task test` passes locally; coverage lcov is produced.  
  [Source](1.1.story.md#qa-results)

### Data Models

- Not applicable for this story. No data models introduced.

### API Specifications

- Not applicable. No HTTP APIs introduced in this story.

### Component Specifications

- Not applicable. This story focuses on CLI bootstrap; no UI components introduced.

### File Locations

- Unified structure requires:
  - `src/` with subfolders: `assets/`, `modules/`, `agents/`, `services/`, `tui/`, `core/`
  - `src/main.ts` as the application entry point
  - Top-level `tests/` mirroring `src/`
  - `.github/workflows/` for CI
  
  [Source](../architecture/unified-project-structure.md#tui-application-structure)

### Testing

- Use Deno's built-in test runner.  
  [Source](../architecture/testing-strategy.md)
- Test discovery via globs for `tests/**/*_test.ts` and `tests/**/*.test.ts`.  
  [Source](../architecture/testing-strategy.md)
- Coverage should be generated and exported to lcov (`coverage.lcov`).  
  [Source](../architecture/testing-strategy.md)
- CLI smoke test must assert exit code `0` and that help output contains a usage banner (e.g., contains "Usage:" and "--version").

### Technical Constraints

- Runtime: Deno (Latest Stable); Language: TypeScript.  
  [Source](../architecture/tech-stack.md#tech-stack)
- Centralize dependencies in `deps.ts`; prefer JSR-first for externals; re-export internal modules.  
  [Source](../typescript-rules.md#dependency--import-strategy-jsr-first-depsts-pinning)
- Explicit `.ts` extensions for internal imports.  
  [Source](../typescript-rules.md#core-rules--rationale)
- Prefer Web APIs/JSR over Node polyfills; `nodeModulesDir` should be `none`.  
  [Source](../typescript-rules.md#node-compatibility-stance-web-apis-first)

### Project Structure Notes

- Ensure `fmt`/`lint` include/exclude patterns reflect the new `src/` and existing `tests/` and avoid `dist/`, `coverage/`, `vendor/`, `node_modules/`, `.git/`.  
  [Source](../typescript-rules.md#project-configuration--ci)
- Keep `legacy/` archived; do not place new code there.  
  [Source](../architecture/unified-project-structure.md#tui-application-structure)

### Debug Log References

- See `.ai/debug-log.md` for any traces captured during development.

### File List

- New
  - `src/main.ts`
  - `src/assets/.gitkeep`
  - `src/modules/.gitkeep`
  - `src/agents/.gitkeep`
  - `src/services/.gitkeep`
  - `src/tui/.gitkeep`
  - `src/core/.gitkeep`
  - `tests/cli_main_test.ts`
- Updated
  - `deps.ts` (exports: parseFlags, log, assertStringIncludes, parseYaml)
  - `deno.jsonc` (tasks now reference `src/main.ts`)
  - `docs/project/stories/1.2.story.md` (this story file)
- Existing/Generated
  - `tests/config_smoke_test.ts`
  - `deno.lock`
  - `coverage.lcov` (generated by coverage task)

## QA Results

Automation executed locally on 2025-08-12 (macOS/zsh):

- deno fmt — clean (0 changes required)
- deno lint — 0 issues
- deno test — 4 passed, 0 failed
  - Coverage: Line 87.2%, Branch 50.0%
  - Reports: `coverage/lcov.info`, HTML at `coverage/html/index.html`

### Review Date: 2025-08-12

### Reviewed By: Quinn (Senior Developer QA)

### Code Quality Assessment

- All acceptance criteria (AC 1–7) are met.
- Unified structure with required subfolders present; minimal CLI implemented.
- CLI correctly supports `--help` and `--version` and defaults to help; tests cover help, version, and default paths.
- Centralized deps via `deps` alias with pinned versions; tasks and CI align with the structure.

### Refactoring Performed

- None required for this story.

### Compliance Check

- Coding Standards: ✓
- Project Structure: ✓
- Testing Strategy: ✓
- All ACs Met: ✓

Notes:

- Minor documentation inconsistency: File List references `coverage/lcov.info`, while the configured coverage task and CI use `coverage.lcov`. Recommend aligning the File List to `coverage.lcov` to match actual behavior.

### Improvements Checklist

- [ ] Add small tests for short flags (`-h`, `-v`) to complement long flags.
- [ ] Update Story File List reference from `coverage/lcov.info` to `coverage.lcov` for consistency.

### Security Review

- No sensitive permissions used; operations limited to argument parsing and console output. No security issues identified for current scope.

### Performance Considerations

- Not applicable; minimal CLI bootstrap only.

### Final Status

✓ Approved - Ready for Done

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| 2025-08-11 | 0.1 | Initial draft created for Story 1.2 (Project structure and CLI bootstrap) | Scrum Master |
| 2025-08-12 | 0.2 | Completed structure and CLI bootstrap; added CLI tests; updated deps and tasks; updated File List; executed Story DoD checklist; QA/coverage recorded; status set to Ready for Review | Developer Agent |

## Dev Agent Record

### Agent Model Used

- Cascade

### DoD Checklist Execution

- Requirements Met
  - [x] All functional requirements implemented
  - [x] All acceptance criteria met
- Coding Standards & Project Structure
  - [x] Adheres to Operational Guidelines and unified structure
  - `N/A` API/Data Models changes
  - [x] Basic security hygiene; no secrets; safe CLI args handling
  - [x] No new linter issues; comments where helpful
- Testing
  - [x] Required unit tests added (CLI smoke tests)
  - `N/A` Integration/E2E tests
  - [x] All tests pass; coverage generated (Line 87.2%, Branch 50.0%)
- Functionality & Verification
  - [x] Manually verified CLI --help/--version and default behavior
  - [x] Basic edge handling via usage/help for no-args
- Story Administration
  - [x] Story tasks marked complete; notes and QA recorded
- Dependencies, Build & Configuration
  - [x] Build/lint/test succeed; centralized deps via JSR
  - `N/A` Env vars/config introduced
- Documentation
  - [x] Story updated; no user-facing docs impacted

- [x] Developer Agent final confirmation: Story 1.2 is ready for review.
